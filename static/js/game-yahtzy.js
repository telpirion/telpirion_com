var AI,ui,utilities,game=function(){"use strict";var e,n,s,o,i,a,r,c,l,t={},_=this,d=["Ones","Twos","Threes","Fours","Fives","Sixes","ThreeKind","FourKind","Small","Large","FullHouse","Chance","Yahtzee"];function u(){e=[{val:0,held:!1},{val:0,held:!1},{val:0,held:!1},{val:0,held:!1},{val:0,held:!1}]}function h(){u(),s=0,o=0,i=3,a=13,r=!1,c=!1;for(var l,e=0;e<d.length;e++)l=d[e],t[l]=utilities.categoryState.open;n=[],n.push(new AI.Robot),n.push(new AI.Robot),n.push(new AI.Robot),n.push(new AI.Robot)}function m(t){var n=e[t];n.held?n.held=!1:n.held=!0,console.log("Die #"+(t+1)+" is held: "+n.held)}function f(e){var n=t[e];n==utilities.categoryState.selected?t[e]=utilities.categoryState.open:t[e]=utilities.categoryState.selected,console.log("Category "+e+" is "+t[e])}function p(){return"Your score: "+s.toString()}function g(){return o}function v(e){return t[e]!=utilities.categoryState.closed}function b(){r=!0;for(var t=0;t<e.length;t++)e[t].held||(e[t].val=utilities.generateRoll());return e}function j(t){var n=utilities.scoreRoll(e,t);s+=n,(t=="Ones"||t=="Twos"||t=="Threes"||t=="Fours"||t=="Fives"||t=="Sixes")&&(o+=n),o>=63&&!c&&(s+=75,c=!0),u()}function y(e){var t=n[e];return t.roll(),t.totalScore}return l={init:h,holdDie:m,selectCategory:f,getScore:p,getTopScore:g,isCategoryAvailable:v,rollDice:b,scoreRoll:j,getOpponentsScore:y},Object.defineProperties(l,{rolls:{set:function(e){i=e},get:function(){return i}},turns:{set:function(e){a=e},get:function(){return a}},isStarted:{get:function(){return r}}}),l}();window.onload=function(){$("svg").click(function(e){ui.clickImage(e)}),$(".cat-lower div").click(function(e){ui.clickImage(e)}),$(".yahtzee div").click(function(e){ui.clickImage(e)}),$("#reset").click(function(){ui.clickReset()}),$("#enter").click(function(){ui.clickEnter()}),$("#roll").click(function(){ui.clickRoll()}),$(".bonus").attr("style","display:none"),$(".game-over").attr("style","display:none"),game.init()},function(e){var t,n=function(){function e(){this._dice=new Array,this._totalScore=0,this._categories=new t;for(var e=0;e<5;e++)this._dice.push({val:0,held:!1})}return e.prototype.roll=function(){for(var n,e=0,s=window.utilities,t=0;t<5;t++)n=s.generateRoll(),this._dice[t].val=n,e+=n;return this._totalScore+=e,e},Object.defineProperty(e.prototype,"totalScore",{get:function(){return this._totalScore},enumerable:!0,configurable:!0}),e}();e.Robot=n,t=function(){function e(){this.numbers=[];for(var e=0;e<6;e++)this.numbers[e]=-1;this.three=-1,this.four=-1,this.small=-1,this.large=-1,this.full=-1,this.chance=-1,this.yatzee=-1}return e}()}(AI||(AI={})),ui=function(){"use strict";var a={1:[[37,37]],2:[[15,15],[60,60]],3:[[15,15],[37,37],[60,60]],4:[[15,15],[15,60],[60,15],[60,60]],5:[[15,15],[15,60],[37,37],[60,15],[60,60]],6:[[15,15],[15,60],[15,37],[60,15],[60,60],[60,37]]};function c(e,n){game.isCategoryAvailable(n)&&(game.selectCategory(n),t(e,"cat"))}function o(e,n){if(game.rolls>0&&game.isStarted){var s;switch(n){case"A":s=0;break;case"B":s=1;break;case"C":s=2;break;case"D":s=3;break;case"E":s=4;break;default:alert("Error: Cannot determine selected die.")}game.holdDie(s),t(e,"die")}}function t(e,t){for(var o,i,s=e.classList,n=0;n<s.length;n++)s[n].indexOf("border")>-1&&(o=s[n]);switch(o){case"borderBlack":i=t=="die"?"borderRed":"borderYellow";break;case"borderRed":case"borderYellow":i="borderBlack"}e.classList.remove(o),e.classList.add(i)}function e(e){for(var s,n=e.classList,o="borderBlack",t=0;t<n.length;t++)n[t].indexOf("border")>-1&&n[t]!=o&&(s=n[t]);e.classList.remove(s),e.classList.add(o)}function i(e){var t,o,i,r,n=$(".dice svg g");n.empty();for(t=0;t<5;t++)o=e[t].val,i=a[o.toString()],r=s(i),n[t].innerHTML=r}function s(e){for(var t,s,o="",i=function(){return'<circle r="10" cx="{0}" cy="{1}"></circle>'},n=0;n<e.length;n++)s=e[n],t=i(),t=t.replace("{0}",s[0].toString()),t=t.replace("{1}",s[1].toString()),o+=t;return o}function r(){var e=[],t=$(".cat");return t.each(function(){$(this)[0].classList.contains("borderYellow")?e.push($(this)[0]):null}),e}function n(e){for(var t,s,n=0;n<e.length;n++)t=e[n],t!="die"&&t!="cat"&&t.indexOf("border")==-1&&(s=t);return s}function l(e,t,n,s){var o=e+"<br/>";o+="Player 2: "+t+"<br/>",o+="Player 3: "+n+"<br/>",o+="Player 4: "+s+"<br/>",$(".score").html(o)}function d(e){var s,i,a,t=e.target;t.tagName.toLowerCase()=="span"?t=t.parentElement:t.tagName.toLowerCase()=="circle"&&(t=t.parentElement.parentElement),i=t.classList,i.contains("cat")?s=c:s=o,a=n(i),s(t,a)}function u(){game.init(),$(".cat").each(function(){e($(this)[0])}),$(".die").each(function(){e($(this)[0]),$(this).attr("src",encodeURI("Assets/Die_1.png"))}),$(".score").html("<div>Your score: 0<br />Player 2: 0<br />Player 3: 0<br />Player 4: 0<br /></div>"),$(".bonus").attr("style","display:none"),$(".game-over").attr("style","display:none"),$("#enter").attr("disabled",!1),$("#roll").attr("disabled",!1)}function h(){if(game.rolls>0){game.rolls--;var e=game.rollDice();i(e)}}function m(){$(".output").text("");var s,o,i,a,c,t=r();t.length==1?(s=n(t[0].classList),game.scoreRoll(s),t[0].classList.remove("borderYellow"),t[0].classList.add("borderGreen"),o=game.getOpponentsScore(0),i=game.getOpponentsScore(1),a=game.getOpponentsScore(2),c=game.getScore(),l(c,o,i,a),game.getTopScore()>=63&&$(".bonus").attr("style",""),game.rolls=3,game.turns--,game.turns>0?$(".die").each(function(){e($(this)[0])}):($("#enter").attr("disabled","true"),$("#roll").attr("disabled","true"),$(".game-over").attr("style","display:block"))):$(".output").text("Please select one and only one category.")}return{clickImage:d,clickReset:u,clickRoll:h,clickEnter:m}}(),utilities=function(){"use strict";var f="0000",u=/00\d0|0\d00/,d="111|1+01+",l="1111",g="00",p="000",t=[{val:0}],c={open:"open",closed:"closed",selected:"selected"};function r(e){for(var t,s,n=0;n<e.length;n++)for(t=0;t<e.length;t++)e[n].val<=e[t].val&&(s=e[t],e[t]=e[n],e[n]=s);return e}function n(e){for(var n="",t=0;t<e.length-1;t++)n+=(e[t+1].val-e[t].val).toString();return n}function a(e){var s=n(e),o=u;return o.test(s)?[{val:25}]:t}function o(e,s){var o,a=n(e),i=t;switch(s){case"Small":o=new RegExp(d),i=o.test(a)?[{val:30}]:t;break;case"Large":o=new RegExp(l),i=o.test(a)?[{val:40}]:t;break}return i}function s(e,s){var i=n(e),o=t;switch(s){case"ThreeKind":i.indexOf("00")>-1&&(o=e);break;case"FourKind":i.indexOf("000")>-1&&(o=e);break;case"Yahtzee":i.indexOf("0000")>-1&&(o=[{val:50}])}return o}function e(e,t){for(var s=[],n=0;n<e.length;n++)e[n].val==t?s.push(e[n]):null;return s}function i(t,n){var i=[{val:0}],c=r(t);switch(n){case"Ones":i=e(c,1);break;case"Twos":i=e(c,2);break;case"Threes":i=e(c,3);break;case"Fours":i=e(c,4);break;case"Fives":i=e(c,5);break;case"Sixes":i=e(c,6);break;case"ThreeKind":i=s(c,"ThreeKind");break;case"FourKind":i=s(c,"FourKind");break;case"Yahtzee":i=s(c,"Yahtzee");break;case"Small":i=o(c,"Small");break;case"Large":i=o(c,"Large");break;case"FullHouse":i=a(c);break;default:i=[{val:0}]}return i}function h(e,t){for(var s=t=="Chance"?e:i(e,t),o=0,n=0;n<s.length;n++)o+=Number(s[n].val);return o}function m(){return Math.floor(Math.random()*6)+1}return{categoryState:c,getRelationships:n,validateFullHouse:a,validateStraightCategory:o,validateKindsCategory:s,validateNumberCategory:e,validateRoll:i,scoreRoll:h,generateRoll:m}}()