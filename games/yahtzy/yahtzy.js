var AI,game=function(){"use strict";var r,a,t,n,o,i,l,c,s={},u=["Ones","Twos","Threes","Fours","Fives","Sixes","ThreeKind","FourKind","Small","Large","FullHouse","Chance","Yahtzee"];function d(){r=[{val:0,held:!1},{val:0,held:!1},{val:0,held:!1},{val:0,held:!1},{val:0,held:!1}]}var e={init:function(){d(),t=3,c=o=!(n=13);for(var e=l=a=0;e<u.length;e++)s[u[e]]=utilities.categoryState.open;(i=[]).push(new AI.Robot),i.push(new AI.Robot),i.push(new AI.Robot),i.push(new AI.Robot)},holdDie:function(e){var t=r[e];t.held?t.held=!1:t.held=!0,console.log("Die #"+(e+1)+" is held: "+t.held)},selectCategory:function(e){s[e]==utilities.categoryState.selected?s[e]=utilities.categoryState.open:s[e]=utilities.categoryState.selected,console.log("Category "+e+" is "+s[e])},getScore:function(){return"Your score: "+a.toString()},getTopScore:function(){return l},isCategoryAvailable:function(e){return s[e]!=utilities.categoryState.closed},rollDice:function(){o=!0;for(var e=0;e<r.length;e++)r[e].held||(r[e].val=utilities.generateRoll());return r},scoreRoll:function(e){var t=utilities.scoreRoll(r,e);a+=t,"Ones"!=e&&"Twos"!=e&&"Threes"!=e&&"Fours"!=e&&"Fives"!=e&&"Sixes"!=e||(l+=t),63<=l&&!c&&(a+=75,c=!0),d()},getOpponentsScore:function(e){return(e=i[e]).roll(),e.totalScore}};return Object.defineProperties(e,{rolls:{set:function(e){t=e},get:function(){return t}},turns:{set:function(e){n=e},get:function(){return n}},isStarted:{get:function(){return o}}}),e}(),ui=(!function(e){function t(){this._dice=new Array,this._totalScore=0,this._categories=new r;for(var e=0;e<5;e++)this._dice.push({val:0,held:!1})}t.prototype.roll=function(){for(var e=0,t=window.utilities,r=0;r<5;r++){var a=t.generateRoll();e+=this._dice[r].val=a}return this._totalScore+=e,e},Object.defineProperty(t.prototype,"totalScore",{get:function(){return this._totalScore},enumerable:!0,configurable:!0}),e.Robot=t;var r=function(){this.numbers=[];for(var e=0;e<6;e++)this.numbers[e]=-1;this.three=-1,this.four=-1,this.small=-1,this.large=-1,this.full=-1,this.chance=-1,this.yatzee=-1}}(AI=AI||{}),function(){"use strict";var n={1:[[37,37]],2:[[15,15],[60,60]],3:[[15,15],[37,37],[60,60]],4:[[15,15],[15,60],[60,15],[60,60]],5:[[15,15],[15,60],[37,37],[60,15],[60,60]],6:[[15,15],[15,60],[15,37],[60,15],[60,60],[60,37]]};function a(e,t){game.isCategoryAvailable(t)&&(game.selectCategory(t),i(e,"cat"))}function o(e,t){if(0<game.rolls&&game.isStarted){var r;switch(t){case"A":r=0;break;case"B":r=1;break;case"C":r=2;break;case"D":r=3;break;case"E":r=4;break;default:alert("Error: Cannot determine selected die.")}game.holdDie(r),i(e,"die")}}function i(e,t){for(var r,a,n=e.classList,o=0;o<n.length;o++)-1<n[o].indexOf("border")&&(r=n[o]);switch(r){case"borderBlack":a="die"==t?"borderRed":"borderYellow";break;case"borderRed":case"borderYellow":a="borderBlack"}e.classList.remove(r),e.classList.add(a)}function l(e){for(var t,r=e.classList,a="borderBlack",n=0;n<r.length;n++)-1<r[n].indexOf("border")&&r[n]!=a&&(t=r[n]);e.classList.remove(t),e.classList.add(a)}function e(e){var t=$(".dice svg g");t.empty();for(var r=0;r<5;r++){var a=e[r].val,a=function(e){for(var t="",r=0;r<e.length;r++){var a=e[r],n='<circle r="10" cx="{0}" cy="{1}"></circle>';n=(n=n.replace("{0}",a[0].toString())).replace("{1}",a[1].toString()),t+=n}return t}(n[a.toString()]);t[r].innerHTML=a}}function c(e){for(var t,r=0;r<e.length;r++){var a=e[r];"die"!=a&&"cat"!=a&&-1==a.indexOf("border")&&(t=a)}return t}return{clickImage:function(e){"span"==(e=e.target).tagName.toLowerCase()?e=e.parentElement:"circle"==e.tagName.toLowerCase()&&(e=e.parentElement.parentElement);var t=e.classList,r=t.contains("cat")?a:o;r(e,c(t))},clickReset:function(){game.init(),$(".cat").each(function(e){l($(this)[0])}),$(".die").each(function(e){l($(this)[0]),$(this).attr("src",encodeURI("Assets/Die_1.png"))}),$(".score").html("<div>Your score: 0<br />Player 2: 0<br />Player 3: 0<br />Player 4: 0<br /></div>"),$(".bonus").attr("style","display:none"),$(".game-over").attr("style","display:none"),$("#enter").attr("disabled",!1),$("#roll").attr("disabled",!1)},clickRoll:function(){0<game.rolls&&(game.rolls--,e(game.rollDice()))},clickEnter:function(){$(".output").text(""),e=[],$(".cat").each(function(){$(this)[0].classList.contains("borderYellow")&&e.push($(this)[0])});var e,t,r,a,n=e;1==n.length?(t=c(n[0].classList),game.scoreRoll(t),n[0].classList.remove("borderYellow"),n[0].classList.add("borderGreen"),t=game.getOpponentsScore(0),n=game.getOpponentsScore(1),r=game.getOpponentsScore(2),a=(a=(a=a=game.getScore())+"<br/>"+("Player 2: "+t+"<br/>"))+"Player 3: "+n+"<br/>Player 4: "+r+"<br/>",$(".score").html(a),63<=game.getTopScore()&&$(".bonus").attr("style",""),game.rolls=3,game.turns--,0<game.turns?$(".die").each(function(){l($(this)[0])}):($("#enter").attr("disabled","true"),$("#roll").attr("disabled","true"),$(".game-over").attr("style","display:block"))):$(".output").text("Please select one and only one category.")}}}()),utilities=function(){"use strict";var t=/00\d0|0\d00/,n=[{val:0}];function o(e){for(var t="",r=0;r<e.length-1;r++)t+=(e[r+1].val-e[r].val).toString();return t}function i(e){e=o(e);return t.test(e)?[{val:25}]:n}function l(e,t){var r=o(e),a=n;switch(t){case"Small":a=new RegExp("111|1+01+").test(r)?[{val:30}]:n;break;case"Large":a=new RegExp("1111").test(r)?[{val:40}]:n}return a}function c(e,t){var r=o(e),a=n;switch(t){case"ThreeKind":-1<r.indexOf("00")&&(a=e);break;case"FourKind":-1<r.indexOf("000")&&(a=e);break;case"Yahtzee":-1<r.indexOf("0000")&&(a=[{val:50}])}return a}function s(e,t){for(var r=[],a=0;a<e.length;a++)e[a].val==t&&r.push(e[a]);return r}function u(e,t){var r=[{val:0}],a=function(e){for(var t,r=0;r<e.length;r++)for(var a=0;a<e.length;a++)e[r].val<=e[a].val&&(t=e[a],e[a]=e[r],e[r]=t);return e}(e);switch(t){case"Ones":r=s(a,1);break;case"Twos":r=s(a,2);break;case"Threes":r=s(a,3);break;case"Fours":r=s(a,4);break;case"Fives":r=s(a,5);break;case"Sixes":r=s(a,6);break;case"ThreeKind":r=c(a,"ThreeKind");break;case"FourKind":r=c(a,"FourKind");break;case"Yahtzee":r=c(a,"Yahtzee");break;case"Small":r=l(a,"Small");break;case"Large":r=l(a,"Large");break;case"FullHouse":r=i(a);break;default:r=[{val:0}]}return r}return{categoryState:{open:"open",closed:"closed",selected:"selected"},getRelationships:o,validateFullHouse:i,validateStraightCategory:l,validateKindsCategory:c,validateNumberCategory:s,validateRoll:u,scoreRoll:function(e,t){for(var r="Chance"==t?e:u(e,t),a=0,n=0;n<r.length;n++)a+=Number(r[n].val);return a},generateRoll:function(){return Math.floor(6*Math.random())+1}}}();window.onload=function(){$("svg").click(function(e){ui.clickImage(e)}),$(".cat-lower div").click(function(e){ui.clickImage(e)}),$(".yahtzee div").click(function(e){ui.clickImage(e)}),$("#reset").click(function(){ui.clickReset()}),$("#enter").click(function(){ui.clickEnter()}),$("#roll").click(function(){ui.clickRoll()}),$(".bonus").attr("style","display:none"),$(".game-over").attr("style","display:none"),game.init()};