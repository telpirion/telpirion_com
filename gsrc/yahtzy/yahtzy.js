var AI,game=function(){"use strict";var r,a,t,n,o,i,l,c,s={},u=["Ones","Twos","Threes","Fours","Fives","Sixes","ThreeKind","FourKind","Small","Large","FullHouse","Chance","Yahtzee"];function d(){r=[{val:0,held:!1},{val:0,held:!1},{val:0,held:!1},{val:0,held:!1},{val:0,held:!1}]}var e={init:function(){d(),t=3,c=o=!(n=13);for(var e=l=a=0;e<u.length;e++)s[u[e]]=utilities.categoryState.open;(i=[]).push(new AI.Robot),i.push(new AI.Robot),i.push(new AI.Robot),i.push(new AI.Robot)},holdDie:function(e){var t=r[e];t.held?t.held=!1:t.held=!0,console.log("Die #"+(e+1)+" is held: "+t.held)},selectCategory:function(e){s[e]==utilities.categoryState.selected?s[e]=utilities.categoryState.open:s[e]=utilities.categoryState.selected,console.log("Category "+e+" is "+s[e])},getScore:function(){return"Your score: "+a.toString()},getTopScore:function(){return l},isCategoryAvailable:function(e){return s[e]!=utilities.categoryState.closed},rollDice:function(){o=!0;for(var e=0;e<r.length;e++)r[e].held||(r[e].val=utilities.generateRoll());return r},scoreRoll:function(e){var t=utilities.scoreRoll(r,e);a+=t,"Ones"!=e&&"Twos"!=e&&"Threes"!=e&&"Fours"!=e&&"Fives"!=e&&"Sixes"!=e||(l+=t),63<=l&&!c&&(a+=75,c=!0),d()},getOpponentsScore:function(e){var t=i[e];return t.roll(),t.totalScore}};return Object.defineProperties(e,{rolls:{set:function(e){t=e},get:function(){return t}},turns:{set:function(e){n=e},get:function(){return n}},isStarted:{get:function(){return o}}}),e}();!function(e){var t=function(){function e(){this._dice=new Array,this._totalScore=0,this._categories=new r;for(var e=0;e<5;e++)this._dice.push({val:0,held:!1})}return e.prototype.roll=function(){for(var e=0,t=window.utilities,r=0;r<5;r++){var a=t.generateRoll();e+=this._dice[r].val=a}return this._totalScore+=e,e},Object.defineProperty(e.prototype,"totalScore",{get:function(){return this._totalScore},enumerable:!0,configurable:!0}),e}();e.Robot=t;var r=function(){this.numbers=[];for(var e=0;e<6;e++)this.numbers[e]=-1;this.three=-1,this.four=-1,this.small=-1,this.large=-1,this.full=-1,this.chance=-1,this.yatzee=-1}}(AI||(AI={}));var ui=function(){"use strict";var o={1:[[37,37]],2:[[15,15],[60,60]],3:[[15,15],[37,37],[60,60]],4:[[15,15],[15,60],[60,15],[60,60]],5:[[15,15],[15,60],[37,37],[60,15],[60,60]],6:[[15,15],[15,60],[15,37],[60,15],[60,60],[60,37]]};function a(e,t){game.isCategoryAvailable(t)&&(game.selectCategory(t),i(e,"cat"))}function n(e,t){if(0<game.rolls&&game.isStarted){var r;switch(t){case"A":r=0;break;case"B":r=1;break;case"C":r=2;break;case"D":r=3;break;case"E":r=4;break;default:alert("Error: Cannot determine selected die.")}game.holdDie(r),i(e,"die")}}function i(e,t){for(var r,a,n=e.classList,o=0;o<n.length;o++)-1<n[o].indexOf("border")&&(r=n[o]);switch(r){case"borderBlack":a="die"==t?"borderRed":"borderYellow";break;case"borderRed":case"borderYellow":a="borderBlack"}e.classList.remove(r),e.classList.add(a)}function c(e){for(var t,r=e.classList,a="borderBlack",n=0;n<r.length;n++)-1<r[n].indexOf("border")&&r[n]!=a&&(t=r[n]);e.classList.remove(t),e.classList.add(a)}function l(e){for(var t="",r=0;r<e.length;r++){var a=e[r],n='<circle r="10" cx="{0}" cy="{1}"></circle>';t+=n=(n=n.replace("{0}",a[0].toString())).replace("{1}",a[1].toString())}return t}function s(e){for(var t,r=0;r<e.length;r++){var a=e[r];"die"!=a&&"cat"!=a&&-1==a.indexOf("border")&&(t=a)}return t}return{clickImage:function(e){var t=e.target;"span"==t.tagName.toLowerCase()?t=t.parentElement:"circle"==t.tagName.toLowerCase()&&(t=t.parentElement.parentElement);var r=t.classList;(r.contains("cat")?a:n)(t,s(r))},clickReset:function(){game.init(),$(".cat").each(function(e){c($(this)[0])}),$(".die").each(function(e){c($(this)[0]),$(this).attr("src",encodeURI("Assets/Die_1.png"))}),$(".score").html("<div>Your score: 0<br />Player 2: 0<br />Player 3: 0<br />Player 4: 0<br /></div>"),$(".bonus").attr("style","display:none"),$(".game-over").attr("style","display:none"),$("#enter").attr("disabled",!1),$("#roll").attr("disabled",!1)},clickRoll:function(){0<game.rolls&&(game.rolls--,function(e){var t=$(".dice svg g");t.empty();for(var r=0;r<5;r++){var a=e[r].val,n=l(o[a.toString()]);t[r].innerHTML=n}}(game.rollDice()))},clickEnter:function(){$(".output").text("");var e,t,r=(e=[],$(".cat").each(function(){$(this)[0].classList.contains("borderYellow")&&e.push($(this)[0])}),e);if(1==r.length){var a=s(r[0].classList);game.scoreRoll(a),r[0].classList.remove("borderYellow"),r[0].classList.add("borderGreen");var n=game.getOpponentsScore(0),o=game.getOpponentsScore(1),i=game.getOpponentsScore(2),l=game.getScore();t=l+"<br/>",t+="Player 2: "+n+"<br/>",t+="Player 3: "+o+"<br/>",t+="Player 4: "+i+"<br/>",$(".score").html(t),63<=game.getTopScore()&&$(".bonus").attr("style",""),game.rolls=3,game.turns--,0<game.turns?$(".die").each(function(){c($(this)[0])}):($("#enter").attr("disabled","true"),$("#roll").attr("disabled","true"),$(".game-over").attr("style","display:block"))}else $(".output").text("Please select one and only one category.")}}}(),utilities=function(){"use strict";var r=/00\d0|0\d00/,n="111|1+01+",o="1111",i=[{val:0}];function l(e){for(var t="",r=0;r<e.length-1;r++)t+=(e[r+1].val-e[r].val).toString();return t}function c(e){var t=l(e);return r.test(t)?[{val:25}]:i}function s(e,t){var r=l(e),a=i;switch(t){case"Small":a=new RegExp(n).test(r)?[{val:30}]:i;break;case"Large":a=new RegExp(o).test(r)?[{val:40}]:i}return a}function u(e,t){var r=l(e),a=i;switch(t){case"ThreeKind":-1<r.indexOf("00")&&(a=e);break;case"FourKind":-1<r.indexOf("000")&&(a=e);break;case"Yahtzee":-1<r.indexOf("0000")&&(a=[{val:50}])}return a}function d(e,t){for(var r=[],a=0;a<e.length;a++)e[a].val==t&&r.push(e[a]);return r}function g(e,t){var r=[{val:0}],a=function(e){for(var t,r=0;r<e.length;r++)for(var a=0;a<e.length;a++)e[r].val<=e[a].val&&(t=e[a],e[a]=e[r],e[r]=t);return e}(e);switch(t){case"Ones":r=d(a,1);break;case"Twos":r=d(a,2);break;case"Threes":r=d(a,3);break;case"Fours":r=d(a,4);break;case"Fives":r=d(a,5);break;case"Sixes":r=d(a,6);break;case"ThreeKind":r=u(a,"ThreeKind");break;case"FourKind":r=u(a,"FourKind");break;case"Yahtzee":r=u(a,"Yahtzee");break;case"Small":r=s(a,"Small");break;case"Large":r=s(a,"Large");break;case"FullHouse":r=c(a);break;default:r=[{val:0}]}return r}return{categoryState:{open:"open",closed:"closed",selected:"selected"},getRelationships:l,validateFullHouse:c,validateStraightCategory:s,validateKindsCategory:u,validateNumberCategory:d,validateRoll:g,scoreRoll:function(e,t){for(var r="Chance"==t?e:g(e,t),a=0,n=0;n<r.length;n++)a+=Number(r[n].val);return a},generateRoll:function(){return Math.floor(6*Math.random())+1}}}();window.onload=function(){$("svg").click(function(e){ui.clickImage(e)}),$(".cat-lower div").click(function(e){ui.clickImage(e)}),$(".yahtzee div").click(function(e){ui.clickImage(e)}),$("#reset").click(function(){ui.clickReset()}),$("#enter").click(function(){ui.clickEnter()}),$("#roll").click(function(){ui.clickRoll()}),$(".bonus").attr("style","display:none"),$(".game-over").attr("style","display:none"),game.init()};